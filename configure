#!/bin/bash
set -o nounset -o errexit -o pipefail

DIR="${BASH_SOURCE%/*}"
if [[ ! -d "$DIR" ]]; then DIR="$PWD"; fi

source $DIR/common.sh

sysname=$(platform)
compiler=$(compiler)

e=0
if [[ -z "${sysname-}" ]]; then
  echo "sorry, could not determine os type (expected linux or darwin)"
  e=1
fi
if [[ -z "${compiler-}" ]]; then
  echo "sorry, could not determine c++ compiler (expected clang++ or g++)"
  e=1
fi

if (( ! $e )); then
  cmd="$DIR/configure-common $sysname $compiler"
  echo $cmd
  exec $cmd
else
  echo sysname=$sysname
  echo compiler=$compiler
  exit $e
fi
