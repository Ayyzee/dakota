#!/bin/bash
set -o nounset -o errexit -o pipefail

DIR="${BASH_SOURCE%/*}"
if [[ ! -d "$DIR" ]]; then DIR="$PWD"; fi

source $DIR/common.sh

rm -f config.mk
rm -f config.sh
rm -f src/config.hh
rm -f lib/dakota/compiler
rm -f lib/dakota/platform.json
rm -f lib/dakota/compiler-default-argument-promotions.json

if (( 0 == $# )); then
  exit
fi

sysname=$1
compiler=$2

source $DIR/config-$sysname.sh

$LN $LNFLAGS $DIR/config-$sysname.mk config.mk
$LN $LNFLAGS $DIR/config-$sysname.sh config.sh

pushd src > /dev/null 2>&1
$LN $LNFLAGS $DIR/src/config-$sysname.hh config.hh
popd > /dev/null 2>&1

pushd lib/dakota > /dev/null 2>&1
$LN $LNFLAGS $DIR/lib/dakota/compiler-$compiler compiler
$LN $LNFLAGS $DIR/lib/dakota/platform-$sysname.json  platform.json
popd > /dev/null 2>&1

make --no-print-directory --directory $DIR/src/port/compiler-default-argument-promotions all
make --no-print-directory --directory $DIR/src/port/compiler-default-argument-promotions clean
