// Copyright (C) 2007, 2008, 2009 Robert Nielsen <robert@dakota.org>
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

digraph "min-syntax-01"
{
  graph [ label = "\G", fontcolor = red ];
  graph [rankdir=LR, rotate=0, page="8.5,11", size="7.5,10"];
  //graph [ratio=compress, ordering="out", pack="true"];
  node  [shape=plaintext];
  edge  [color=grey];

  // mangled names to label table
  "klass-<qual-ident>" [label="<qual-ident>"];
  "klass-;" [label=";"];
  "klass-{" [label="{"];
  "klass-}" [label="}"];

  // mangled names to label table
  "methods-<qual-ident>" [label="<qual-ident>"];
  "methods-;" [label=";"];
  "methods-{" [label="{"];
  "methods-}" [label="}"];

  // mangled names to label table
  "<klass-scope>-klass" [label="klass"];



  // mangled names to label table
  "<klass-scope>-klass-klass" [label="klass"];
  "<klass-scope>-klass-klass-<qual-ident>" [label="<qual-ident>"];
  "<klass-scope>-klass-klass-;" [label=";"];

  // mangled names to label table
  "<klass-scope>-superklass" [label="superklass"];
  "<klass-scope>-superklass-<qual-ident>" [label="<qual-ident>"];
  "<klass-scope>-superklass-;" [label=";"];

  // mangled names to label table
  "root-<file-scope>" [label="<file-scope>"];
  "root-<klass-scope>" [label="<klass-scope>"];

  "root-<file-scope>" -> "klass";
  "root-<file-scope>" -> "methods";
  "root-<file-scope>" -> "generic";

  "klass" -> "klass-<qual-ident>";
               "klass-<qual-ident>" -> "klass-;";
               "klass-<qual-ident>"
                 -> "klass-{"
                 -> "<klass-scope>"
                 -> "klass-}";

  "methods" -> "methods-<qual-ident>";
                 "methods-<qual-ident>" -> "methods-;";
                 "methods-<qual-ident>"
                   -> "methods-{"
                   -> "<methods-scope>"
                   -> "methods-}";

  // mangled names to label table
  "generic-..." [label="...", shape=circle];
  "generic-;" [label=";"];

  "generic" -> "generic-..." -> "generic-;";

  // mangled names to label table
  //
  "root-<slots-scope>" [label="<slots-scope>"];
  "root-<slots-scope>-<qual-type>" [label="<qual-type>"];  
  "root-<slots-scope>-<ident>" [label="<ident>"];  
  "root-<slots-scope>-;" [label=";"];  

  "root-<klass-scope>" -> "<klass-scope>-klass";
  //

  "root-<klass-scope>"
    -> "<klass-scope>-superklass"; //[label=">=0 and <=1", fontcolor=grey];

  "root-<klass-scope>" -> "<klass-scope>-klass-klass"

  "<klass-scope>-klass"
    -> "<klass-scope>-klass-klass"
    -> "<klass-scope>-klass-klass-<qual-ident>"
    -> "<klass-scope>-klass-klass-;";

  "<klass-scope>-klass"
    -> "<klass-scope>-superklass"
    -> "<klass-scope>-superklass-<qual-ident>"
    -> "<klass-scope>-superklass-;";

  "root-<slots-scope>"
    -> "root-<slots-scope>-<qual-type>"
    -> "root-<slots-scope>-<ident>"
    -> "root-<slots-scope>-;"

  // mangled names to label table
  "root-<klass-scope>" [label="<klass-scope>"];

  // mangled names to label table
  "root-<klass-scope>" [label="<klass-scope>"];
  "<klass-scope>-slots" [label="slots"];
  "<klass-scope>-slots-<qual-type>" [label="<qual-type>"];
  "<klass-scope>-slots-;" [label=";"];
  "<klass-scope>-slots-{" [label="{"];
  "<klass-scope>-slots-}" [label="}"];
  
  "root-<klass-scope>"
    -> "<klass-scope>-slots";
                            
  "<klass-scope>-import" [label="import"];
  "<klass-scope>-export" [label="export"];

  "root-<klass-scope>" -> "<klass-scope>-import";
  "root-<klass-scope>" -> "<klass-scope>-export";

  "<klass-scope>-import-klass" [label="klass"];
  "<klass-scope>-export-klass" [label="klass"];
  "root-<klass-scope>" -> "<klass-scope>-import-klass";
  "root-<klass-scope>" -> "<klass-scope>-export-klass";
//    "<klass-scope>-import" -> "<klass-scope>-klass";
//    "<klass-scope>-export" -> "<klass-scope>-klass";
  "<klass-scope>-import" -> "<klass-scope>-import-klass";
  "<klass-scope>-export" -> "<klass-scope>-export-klass";

  "<klass-scope>-import" -> "<klass-scope>-method-dcl";
  "<klass-scope>-export" -> "<klass-scope>-method-dfn";

  "<klass-scope>-import-klass" -> "<klass-scope>-method-dcl";
  "<klass-scope>-export-klass" -> "<klass-scope>-method-dfn";

  "<klass-scope>-klass" -> "<klass-scope>-slots";
  
                            "<klass-scope>-slots" -> "<klass-scope>-slots-;" [label="slots-t", fontcolor=grey];
                            "<klass-scope>-slots" -> "<klass-scope>-slots-{" [label="slots-t", fontcolor=grey];
                            
                            "<klass-scope>-slots" -> "<klass-scope>-slots-<qual-type>";
                            "<klass-scope>-slots-<qual-type>" -> "<klass-scope>-slots-;";


                            "<klass-scope>-slots-<qual-type>" -> "<klass-scope>-slots-{";

                            "<klass-scope>-slots-{"
                              -> "<slots-scope>"
                              -> "<klass-scope>-slots-}";

  // mangled names to label table
  "<klass-scope>-method-dcl"      [label="method"];
  "<klass-scope>-method-dfn"      [label="method"];
  "<klass-scope>-method-dcl-..."  [label="...", shape=circle];
  "<klass-scope>-method-dfn-..."  [label="...", shape=circle];
  "<klass-scope>-method-;"        [label=";"];
  "<klass-scope>-method-{"        [label="{"];
  "<klass-scope>-method-body-..." [label="..."];
  "<klass-scope>-method-}"        [label="}"];

  "root-<klass-scope>"
    -> "<klass-scope>-method-dcl";
  "root-<klass-scope>"
    -> "<klass-scope>-method-dfn";
                            
  "<klass-scope>-method-dcl" -> "<klass-scope>-method-dcl-...";
  "<klass-scope>-method-dfn" -> "<klass-scope>-method-dfn-...";
  "<klass-scope>-method-dcl-..."
    -> "<klass-scope>-method-;";
  "<klass-scope>-method-dfn-..."
    -> "<klass-scope>-method-{"
    -> "<klass-scope>-method-body-..."
    -> "<klass-scope>-method-}";

  // mangled names to label table
  "<klass-scope>-methods" [label="methods"];
  "<klass-scope>-methods-<qual-ident>" [label="<qual-ident>"];
  "<klass-scope>-methods-;" [label=";"];

  "root-<klass-scope>"
    -> "<klass-scope>-methods";
                            
  "<klass-scope>-klass" -> "<klass-scope>-methods"
                         -> "<klass-scope>-methods-<qual-ident>"
                         -> "<klass-scope>-methods-;";

  // mangled names to label table
  "root-<methods-scope>"         [label="<methods-scope>"];
  "<methods-scope>-import"     [label="import"];
  "<methods-scope>-export"     [label="export"];
  "<methods-scope>-method-dcl"     [label="method"];
  "<methods-scope>-method-dfn"     [label="method"];
  "<methods-scope>-method-dcl-..." [label="...", shape=circle];
  "<methods-scope>-method-dfn-..." [label="...", shape=circle];
  "<methods-scope>-method-;" [label=";"];
  "<methods-scope>-method-{" [label="{"];
  "<methods-scope>-method-body-..." [label="..."];
  "<methods-scope>-method-}" [label="}"];
    
  "root-<methods-scope>" -> "<methods-scope>-import" -> "<methods-scope>-method-dcl";
  "root-<methods-scope>" -> "<methods-scope>-export" -> "<methods-scope>-method-dfn";
  "root-<methods-scope>" -> "<methods-scope>-method-dcl";
  "root-<methods-scope>" -> "<methods-scope>-method-dfn";
  
  "<methods-scope>-method-dcl" -> "<methods-scope>-method-dcl-...";
  "<methods-scope>-method-dfn" -> "<methods-scope>-method-dfn-...";
  "<methods-scope>-method-dcl-..."
    ->  "<methods-scope>-method-;";
  "<methods-scope>-method-dfn-..."
    ->  "<methods-scope>-method-{"
    ->  "<methods-scope>-method-body-..."
    ->  "<methods-scope>-method-}";

  {
    rank=same;
    "<methods-scope>-import"
    "<methods-scope>-export"
    "<klass-scope>-import"
    "<klass-scope>-export"
  }

  {
    rank=same;
    "<klass-scope>-klass"
    "<klass-scope>-import-klass"
    "<klass-scope>-export-klass"
  }

  {
    rank=same;
    "<methods-scope>-method-dcl"
    "<methods-scope>-method-dfn"
    "<klass-scope>-method-dcl"
    "<klass-scope>-method-dfn"
  }
}
