// Copyright (C) 2007 - 2015 Robert Nielsen <robert@dakota.org>
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

digraph "macro-syntax-fsm"
{
  graph [ label = "\G", fontcolor = red ];
  graph [ rankdir = "LR",
          center = true,
          //size = "7.5,10",
          ];

  //node [ shape = circle, label = "", width = 0.25 ];
  // OR
  node [ shape = circle ];

  edge [ fontname = "courier" ];

  00 [ style = invis ];
  14 [ shape = doublecircle ];

  00 -> 01;
  01 -> 02 [ label = "macro", fontname = "courier-bold" ];
  02 -> 03 [ label = "ident", fontname = "courier-italic" ];
  03 -> 04 [ label = "[", fontname = "courier-bold" ];
  03 -> 06 [ label = "{", fontname = "courier-bold", weight = 4.0 ];
  04 -> 04 [ label = "ident", fontname = "courier-italic" ];
  04 -> 05 [ label = "]", fontname = "courier-bold" ];
  05 -> 06 [ label = "{", fontname = "courier-bold" ];

  06 -> 07 [ label = "ident", fontname = "courier-italic" ];
  06 -> 08 [ label = "{", fontname = "courier-bold", weight = 4.0 ];
  06 -> 14 [ label = "}", fontname = "courier-bold" ];
  07 -> 08 [ label = "{", fontname = "courier-bold" ];
  08 -> 06 [ label = "}", fontname = "courier-bold", color = blue, weight = 1.0 ]; // back
  
  08 -> 09 [ label = "pattern", fontname = "courier-italic" ];
  08 -> 10 [ label = "}", fontname = "courier-bold", weight = 4.0 ];
  09 -> 06 [ label = "}", fontname = "courier-bold", color = blue, weight = 1.0 ]; // back

  09 -> 10 [ label = "}", fontname = "courier-bold" ];
  10 -> 11 [ label = "=>", fontname = "courier-bold", weight = 4.0 ];
  11 -> 12 [ label = "{", fontname = "courier-bold", weight = 4.0 ];
  12 -> 13 [ label = "template", fontname = "courier-italic", weight = 4.0 ];
  12 -> 06 [ label = "}", fontname = "courier-bold", color = blue, weight = 1.0 ]; // back
  13 -> 06 [ label = "}", fontname = "courier-bold", color = blue, weight = 1.0 ]; // back

  subgraph { graph [ rank = same ]; 06; 14; }
}
// named   pattern(s)  (macro m { p1 {}       {}       p2 {}       {}       ... })
// unnamed pattern     (macro m {    {}       {}          {}       {}           })
// named   rule set(s) (macro m { r1 {} => {} {} => {} r2 {} => {} {} => {} ... })
// unnamed rule set    (macro m {    {} => {} {} => {}    {} => {} {} => {}     })

// one and only one unnamed rule set xor unnamed pattern (which is the macro entry point)

// macro m              { klass-or-trait { klass }              { trait }          ... }
// macro klass-or-trait {                { klass }              { trait }              }
// macro klass-or-trait {                { klass } => { klass } { trait } => { trait } }
