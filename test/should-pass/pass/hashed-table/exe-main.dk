// -*- mode: Dakota; c-basic-offset: 2; tab-width: 2; indent-tabs-mode: nil -*-

klass features; // hackhack
klass hashed-table;
klass json-object-output-stream;
klass string;
klass vector;

int-t main()
{
  int-t value = 0;

  try
  {
    object-t json-object-output-stream = make(json-object-output-stream::klass, #file : stdout);
    object-t table =  make(hashed-table::klass);
    object-t vector =  make(vector::klass);
    object-t string1 = make(string::klass, #bytes : "hello father");
    object-t string2 = make(string::klass, #bytes : "hello mother");
    $add-last(vector, string1);
    $add-last(vector, vector);
    $add-last(vector, string2);
    $add-last(vector, null);
    $add(table, string2, vector);

    $write(json-object-output-stream, table);
    $close(json-object-output-stream);
  }
  catch(...)
  {
    fprintf(stderr, "ERROR: uncaught exception\n");
    value = 1;
  }

  return value;
}
