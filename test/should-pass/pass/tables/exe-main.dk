// -*- mode: Dakota; c-basic-offset: 2; tab-width: 2; indent-tabs-mode: nil -*-

#include <stdio.h>
#include <assert.h>

klass sorted-table;
klass hashed-table;
klass pair;
klass uint32;

static object-t check(object-t klass)
{
  object-t collection = make(klass);

  for (uint32-t i = 1; i < 1 + 5; i++) {
    object-t e = uint32::box(i);
    for (uint32-t j = 1; j <= i; j++)
      $add(collection, e, e);
  }
  printf("size=%i\n", $size(collection));
  uint32-t i1 = 1;

  for (object-t e in collection) {
    pair-t* pair = pair::unbox(e);
    uint32-t ei = *uint32::unbox(pair->first);
    object-t element = $at(collection, e, nullptr);
    uint32-t i2 = *uint32::unbox(element);
    printf("%i: %i == %i\n", i1, ei, i2);
    i1++;
  }
  return collection;
}

int-t main()
{
//object-t json-object-output-stream = make(json-object-output-stream::klass);

  object-t c1 = check(sorted-table::klass);
  USE(c1);
//$write(json-object-output-stream, c1);

  object-t c2 = check(hashed-table::klass);
  USE(c2);
//$write(json-object-output-stream, c2);

//$close(json-object-output-stream);

  return 0;
}
